local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Pilgrammed.exe",
    LoadingTitle = "Pilgrammed.exe",
    LoadingSubtitle = "Like and subscribe",
    ConfigurationSaving = {Enabled = false},
    KeySystem = false,
})

local CombatTab = Window:CreateTab("Combat", 4483362458)

local remote = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("Block")
local args = {true}
local parryConnection = nil
local lastParryTime = 0

-- Lightweight parry: rapid burst when threat is near
local function startParry()
    if parryConnection then return end
    
    local player = game.Players.LocalPlayer
    local detectionRadius = 8
    
    parryConnection = task.spawn(function()
        while parryConnection do
            task.wait(0.08) -- Check ~12 times/sec (lightweight)
            
            local char = player.Character
            if not char or not char:FindFirstChild("HumanoidRootPart") then continue end
            
            local rootPos = char.HumanoidRootPart.Position
            
            -- Fast spatial query
            local parts = workspace:GetPartBoundsInRadius(rootPos, detectionRadius)
            
            -- If ANY part detected and cooldown passed, fire burst
            if #parts > 0 and tick() - lastParryTime >= 0.12 then
                -- 5 rapid fires for perfect parry window
                for i = 1, 5 do
                    remote:FireServer(unpack(args))
                    task.wait(0.006) -- 6ms between fires
                end
                lastParryTime = tick()
            end
        end
    end)
end

local function stopParry()
    parryConnection = nil
end

CombatTab:CreateToggle({
    Name = "Auto Parry",
    CurrentValue = false,
    Flag = "AutoParry",
    Callback = function(Value)
        if Value then
            startParry()
        else
            stopParry()
        end
    end,
})

game:GetService("UserInputService").InputBegan:Connect(function(input, gP)
    if gP then return end
    if input.KeyCode == Enum.KeyCode.K then
        Rayfield:Toggle()
    end
end)
