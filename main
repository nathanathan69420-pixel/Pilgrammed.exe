local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Pilgrammed.exe",
    LoadingTitle = "Pilgrammed.exe",
    LoadingSubtitle = "Like and subscribe",
    ConfigurationSaving = {Enabled = false},
    KeySystem = false,
})

local CombatTab = Window:CreateTab("Combat", 4483362458)

local remote = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("Block")
local args = {true}
local parryLoop = nil
local lastParry = 0
local player = game.Players.LocalPlayer

-- **THE KEY: Predictive timing + single burst when attack is in perfect range**
local function startParry()
    if parryLoop then return end
    
    parryLoop = true
    
    task.spawn(function()
        while parryLoop do
            -- **Critical: 0.03s check (33 times/sec) - fast enough without lag**
            task.wait(0.03)
            
            local char = player.Character
            if not char or not char:FindFirstChild("HumanoidRootPart") then continue end
            
            -- **Ultra-fast spatial query: 10 stud radius**
            local threats = workspace:GetPartBoundsInRadius(char.HumanoidRootPart.Position, 10)
            
            -- **Single burst when threat is 2-5 studs away (perfect parry window)**
            for _, part in ipairs(threats) do
                if tick() - lastParry < 0.15 then break end -- Don't spam
                
                local dist = (part.Position - char.HumanoidRootPart.Position).Magnitude
                
                -- **PERFECT PARRY WINDOW: 2-5 studs**
                -- This is when you MUST block to parry, not before or after
                if dist >= 2 and dist <= 5 then
                    local name = part.Name
                    
                    -- **Aggressive pattern matching for attacks**
                    if name:match("Projectile") or name:match("Attack") or name:match("Hitbox") or 
                       name:match("Damage") or name:match("Swing") or name:match("Weapon") or
                       part:FindFirstChild("BodyVelocity") or part:FindFirstChild("BodyGyro") then
                        
                        -- **CRITICAL: Fire 3x in 20ms for perfect timing**
                        for i = 1, 3 do
                            remote:FireServer(unpack(args))
                            task.wait(0.01) -- 10ms between fires
                        end
                        
                        lastParry = tick()
                        break -- Exit after burning parry
                    end
                end
            end
        end
    end)
end

local function stopParry()
    parryLoop = nil
end

CombatTab:CreateToggle({
    Name = "Auto Parry",
    CurrentValue = false,
    Flag = "AutoParry",
    Callback = function(Value)
        if Value then
            startParry()
        else
            stopParry()
        end
    end,
})

game:GetService("UserInputService").InputBegan:Connect(function(input, gP)
    if gP then return end
    if input.KeyCode == Enum.KeyCode.K then
        Rayfield:Toggle()
    end
end)
